config router prefix-list
    edit "ONLY_DEFAULT"
        config rule
            edit 1
                set prefix 0.0.0.0 0.0.0.0
                unset ge
                unset le
            next
        end
    next
    edit "PL_BRANCH_LOCAL_PREFIX"
        config rule
            edit 1
                set prefix 10.10.110.0 255.255.255.0
                unset ge
                unset le
            next
            edit 100
                set action deny
                set prefix 0.0.0.0 0.0.0.0
                unset ge
                unset le
            next
        end
    next
    edit "PL_LOOPBACK_SUBNET"
        config rule
            edit 1
                set prefix {{overlay_variables.loopback_ip}} {{overlay_variables.loopback_network_mask}}
                unset ge
                unset le
            next
        end
    next
    edit "PL_RFC1918_EXACT_MATCH"
        config rule
            edit 10
                set prefix {{overlay_variables.loopback_ip}} {{overlay_variables.loopback_network_mask}}
                unset ge
                unset le
            next
            edit 20
                set prefix 10.0.0.0 255.0.0.0
                unset ge
                unset le
            next
            edit 30
                set prefix 192.168.0.0 255.255.0.0
                unset ge
                unset le
            next
        end
    next
end
 
config router route-map
    edit "RTMAP_IN_DYN_BGP"
        config rule
            edit 10
                set action deny
                set match-ip-address "PL_RFC1918_EXACT_MATCH"
                unset set-ip-prefsrc
            next
            edit 100
                unset set-ip-prefsrc
                set set-route-tag 100
            next
        end
    next
    {% for i in range(data.number_of_hubs) %}
    edit "RTMAP_IN_HUB{{i+1}}"
        config rule
            edit 10
                set action deny
                set match-ip-address "PL_RFC1918_EXACT_MATCH"
                unset set-ip-prefsrc
            next
            edit 100
                unset set-ip-prefsrc
                set set-tag {{i+1}}
                set set-route-tag {{i+1}}
            next
        end
    next
    {% endfor %}
    edit "RTMAP_OUT"
        config rule
            edit 10
                set set-community "{{overlay_variables.as_id}}:100"
                unset set-ip-prefsrc
            next
        end
    next
end
 
 
config router prefix-list
    edit "LOOPBACK_RANGE"  
        config rule
            edit 1
                set prefix {{overlay_variables.loopback_ip}} {{overlay_variables.loopback_network_mask}}
                unset ge
                unset le
            next
        end
    next
    edit "PL_DC_SUBNETS"
        config rule
            edit 1
                set prefix 10.100.100.1 255.255.255.255
                unset ge
                unset le
            next
        end
    next
    edit "PL_ONLY_DEFAULT"
        config rule
            edit 1
                set prefix 0.0.0.0 0.0.0.0
                unset ge
                unset le
            next
        end
    next
end
 
config router route-map
    edit "RTMAP_IN_ALL_OVERLAYS"
        config rule
            edit 5
                set action deny
                set match-ip-address "PL_ONLY_DEFAULT"
                unset set-ip-prefsrc
            next
            edit 10
                set action deny
                set match-ip-address "PL_RFC1918_EXACT_MATCH"
                unset set-ip-prefsrc
            next
            edit 100
                unset set-ip-prefsrc
            next
        end
    next
    edit "RTMAP_OUT_ALL_OVERLAYS"
        config rule
            edit 5
                set match-ip-address "LOOPBACK_RANGE"
                set set-community "{{overlay_variables.as_id}}:1"
                unset set-ip-prefsrc
            next
            edit 100
                set action deny
                unset set-ip-prefsrc
            next
            edit 3
                set match-ip-address "PL_DC_SUBNETS"
                set set-community "{{overlay_variables.as_id}}:1"
                unset set-ip-prefsrc
            next
        end
    next
end
